var waitForWeb3=function(){"undefined"==typeof web3?(console.log("Meta Mask required!"),setTimeout(function(){waitForWeb3()},200)):(web3=new Web3(web3.currentProvider),web3.eth.accounts.length>0?($("#isconnected").hide(),setTimeout(function(){console.log("account found"),web3.version.getNetwork(function(o,t){switch(t){case"1":console.log("This is mainnet");break;case"2":console.log("This is the deprecated Morden test network.");break;case"3":console.log("This is the ropsten test network.");break;default:console.log("This is an unknown network.")}}),startApp()},500)):setTimeout(function(){console.log("no account available"),waitForWeb3()},200))},startApp=function(){$(".loader").hide(),ipfs=window.IpfsApi(ipfsHost,ipfsPort,{protocol:ipfsProtocol}),$("ul li").hide().eq(0).show(),$("#poll_description").trumbowyg(),$("#minEthTransactionDetail").html(minEthTransaction),$("#poll_contract").keyup(function(){var o=$(this).val();parseInt(o)>=0?($("#error_poll_contract").hide(),$("#poll_contract").css("background-color","#c9ff83"),$(".poll_symbol").slideDown("slow","swing")):($("#error_poll_contract").show().html("enter valid contract address.").css("color","red").css("font-weight","400"),$(".submit").css("display","none"),$("#poll_contract").css("background-color","#ffffff"),$(".options_list").hide(500),$(".poll_description").hide(500),$(".poll_num_choices").hide(500),$(".poll_title").hide(500))}),$("#poll_symbol").keyup(function(){var o=$(this).val();titleReg.test(o)?($("#error_poll_symbol").hide(),$("#poll_symbol").css("background-color","#c9ff83"),$(".poll_title").slideDown("slow","swing")):($("#error_poll_symbol").show().html("enter valid token symbol.").css("color","red").css("font-weight","400"),$(".submit").css("display","none"),$("#poll_symbol").css("background-color","#ffffff"),$(".options_list").hide(500),$(".poll_description").hide(500),$(".poll_num_choices").hide(500),$(".poll_title").hide(500))}),$("#poll_title").keyup(function(){var o=$(this).val();titleReg.test(o)?($("#error_poll_title").hide(),$("#poll_title").css("background-color","#c9ff83"),$(".poll_description").slideDown("slow","swing"),$(".poll_num_choices").slideDown("slow","swing")):($("#error_poll_title").show().html("enter valid alpha numeric title.").css("color","red").css("font-weight","400"),$(".submit").css("display","none"),$("#poll_title").css("background-color","#ffffff"),$(".options_list").hide(500),$(".poll_description").hide(500),$(".poll_num_choices").hide(500))}),$("#poll_num_choices").change(function(){var o=$(this).val();$("#error_poll_num_choices").hide(),$("#poll_num_choices").css("background-color","#c9ff83"),$(".options_list").slideDown("slow","swing"),$(".poll_amount").slideDown("slow","swing"),$("#choice").empty();for(var t=1;t<=o;t++)$("#choice").append("<b>Option "+t+'</b><textarea name="choice-'+t+'" id="choice-'+t+'" ></textarea>'),$("#choice-"+t).trumbowyg()}),$("#poll_amount").keyup(function(){var o=$(this).val();!isNaN(parseFloat(o))&&isFinite(o)&&parseFloat(o)>=minEthTransaction?($("#error_poll_amount").hide(),$(".submit").slideDown("slow","swing")):($("error_poll_amount").show().html("enter valid number greater than "+minEthTransaction).css("color","red").css("font-weight","400"),$(".submit").css("display","none"),$("#poll_amount").css("background-color","#ffffff"))}),$("#submit").click(function(){$(".loader").show(),$("#submit").attr("disabled",!0);var o=$("#form").serializeArray().reduce(function(o,t){return o[t.name]=t.value,o},{}),t=JSON.stringify(o),e=ipfs.Buffer.from(JSON.stringify(t));ipfs.add(e,function(t,e){if(console.log(t),e){$(".loader").hide();var l=e[0].hash;$("#success-msg").html("Created IPFS node at <b>"+l+"</b>. Uploading to contract on Blockchain now. Please Submit the transaction."),distrivoteContract=web3.eth.contract(distrivoteContractABI).at(distrivoteContractAddress);var s=o.poll_contract,i=parseInt(o.poll_num_choices),n=parseFloat($("#poll_amount").val());console.log(l,s,i,{value:web3.toWei(n,"ether")}),distrivoteContract.createPoll(l,s,i,{value:web3.toWei(n,"ether")},function(o,t){if(console.log(o,t),parseInt(t)>0){var e="https://coinvoting.github.io/v1/vote.html?hash="+l,s="https://etherscan.io/tx/"+t;$("#formlists").hide(),$("#aboutd").hide(),$("#success-msg").html('<h1>Poll created successfully <a href="'+e+'" target="_blank">here</a><br/></h1> <br/><small><a href="'+e+'" target="_blank">'+e+'</a></small><br/><br/>Check <a href="'+s+'" target="_blank">'+s+"</a> for transaction completion before sharing.")}})}})})};$(document).ready(function(){$.getScript("js/constants.js",function(){waitForWeb3()})});
